<div class="mt-3 mb-3">
    <h5>{{ 'MANAGE_COMPANY_BRANCHES' | translate }}</h5>
    <span class="text-muted">
        {{ 'DASHBOARD' | translate }} 
        <i [ngClass]="'fa-solid ' + ('icon-class' | translate)"></i> 
        {{ 'ADD_COMPANY_BRANCH' | translate }} 
        <i [ngClass]="'fa-solid ' + ('icon-class' | translate)"></i> 
        {{ 'ADD_COMPANY_BRANCH' | translate }}
    </span>
</div>

<div class="mt-4 mb-4">
    <form [formGroup]="companyBranchForm" (ngSubmit)="handleForm()">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="card shadow em-card rounded-lg">
                        <div class="card-header bg-white text-black rounded-top pt-3">
                            <h5>{{ 'ADD_COMPANY_BRANCH' | translate }}</h5>
                        </div>
                        <div class="card-body pb-5">
                            <div class="row">
                                <div class="form-group col-md-6">
                                    <label for="name" class="form-label">
                                        {{ 'NAME' | translate }}
                                    </label>
                                    <input id="name" formControlName="name" type="text" class="form-control" 
                                        [placeholder]="'ADD_NAME' | translate"
                                        [class.is-invalid]="companyBranchForm.get('name')?.errors && isSubmitted" />

                                    <div class="invalid-feedback" *ngIf="companyBranchForm.get('name')?.errors && isSubmitted">
                                        <p *ngIf="companyBranchForm.get('name')?.getError('required')">
                                            {{ 'NAME_REQUIRED' | translate }}
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="form-group col-md-12 mt-4">
                                    <label for="description" class="form-label">
                                        {{ 'DESCRIPTION' | translate }}
                                    </label>
                                    <textarea id="description" formControlName="description" class="form-control" 
                                        [placeholder]="'ADD_DESCRIPTION' | translate"
                                        [class.is-invalid]="companyBranchForm.get('description')?.errors && isSubmitted"></textarea>

                                    <div class="invalid-feedback" *ngIf="companyBranchForm.get('description')?.errors && isSubmitted">
                                        <p *ngIf="companyBranchForm.get('description')?.getError('required')">
                                            {{ 'DESCRIPTION_REQUIRED' | translate }}
                                        </p>
                                    </div>
                                </div>

                                <div class="form-group col-md-6 mt-4">
                                    <label for="country" class="form-label">
                                        {{ 'COUNTRY' | translate }}
                                    </label>
                                    <select id="country" class="form-control" 
                                        (change)="onCountryChange($event)"
                                        formControlName="country_id"
                                        [class.is-invalid]="companyBranchForm.get('country_id')?.errors && isSubmitted">
                                        <option value="" disabled>{{ 'SELECT_COUNTRY' | translate }}</option>
                                        <option *ngFor="let country of countries" [value]="country.id">
                                            {{ country.name }}
                                        </option>
                                    </select>
                                    <div class="invalid-feedback" *ngIf="companyBranchForm.get('country_id')?.errors && isSubmitted">
                                        <p *ngIf="companyBranchForm.get('country_id')?.getError('required')">
                                            {{ 'COUNTRY_REQUIRED' | translate }}
                                        </p>
                                    </div>
                                </div>

                                <div class="form-group col-md-6 mt-4">
                                    <label for="city" class="form-label">
                                        {{ 'CITY' | translate }}
                                    </label>
                                    <select id="city" class="form-control" 
                                        formControlName="city_id"
                                        [class.is-invalid]="companyBranchForm.get('city_id')?.errors && isSubmitted"
                                        [disabled]="!cities.length">
                                        <option value="" disabled>{{ 'SELECT_CITY' | translate }}</option>
                                        <option *ngFor="let city of cities" [value]="city.id">
                                            {{ city.name }}
                                        </option>
                                    </select>
                                    <div class="invalid-feedback" *ngIf="companyBranchForm.get('city_id')?.errors && isSubmitted">
                                        <p *ngIf="companyBranchForm.get('city_id')?.getError('required')">
                                            {{ 'CITY_REQUIRED' | translate }}
                                        </p>
                                    </div>
                                    <div *ngIf="!cities.length && companyBranchForm.get('country_id')?.value" class="alert alert-warning mt-2">
                                        {{ 'PLEASE_SELECT_A_COUNTRY_HAS_CITIES' | translate }}
                                    </div>
                                </div>
                               
                                 <div class="form-group col-md-12 mt-4">
                                    <label for="address_details" class="form-label">
                                        {{ 'ADDRESS_DETAILS' | translate }}
                                    </label>
                                    <textarea id="address_details" formControlName="address_details" class="form-control" 
                                        [placeholder]="'ADD_ADDRESS_DETAILS' | translate"
                                        [class.is-invalid]="companyBranchForm.get('address_details')?.errors && isSubmitted"></textarea>

                                    <div class="invalid-feedback" *ngIf="companyBranchForm.get('address_details')?.errors && isSubmitted">
                                        <p *ngIf="companyBranchForm.get('address_details')?.getError('required')">
                                            {{ 'ADDRESS_DETAILS_REQUIRED' | translate }}
                                        </p>
                                    </div>
                                 </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-4 mb-4">
                    <button type="submit" class="btn btn-primary px-4">
                        <i *ngIf="isLoading" class="fas fa-spinner fa-spin"></i>
                        {{ 'addColor.save' | translate }}
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>